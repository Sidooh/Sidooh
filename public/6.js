(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{82:function(t,e,o){"use strict";o.r(e);var r=o(1),n=o.n(r),a=o(0),s=o(3),i=o.n(s);function u(t,e,o,r,n,a,s){try{var i=t[a](s),u=i.value}catch(t){return void o(t)}i.done?e(u):Promise.resolve(u).then(r,n)}function c(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,r)}return o}function l(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?c(Object(o),!0).forEach((function(e){m(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):c(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function m(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var h={name:"Airtime",data:function(){return{form:{other_phone:null,amount:"",purchaseMethod:"MPESA"},airtimeAmounts:{20:"20",50:"50",100:"100",200:"200",500:"500",1e3:"1000","-1":"Other"},minAmount:10,maxAmount:10002340,otherAmount:!1,otherNumber:!1,options:["MPESA","VOUCHER"],selectedOption:"MPESA",validation:{other_phone:"",amount:"",purchaseMethod:""},showError:!1,loading:!1,message:"",error:null}},computed:l(l(l({},Object(a.c)("Purchases",["errors"])),Object(a.c)("Accounts",["voucherBalance"])),{},{validForm:function(){return!this.validation.amount&&!this.validation.purchaseMethod&&(!this.otherNumber||!this.validation.other_phone)&&this.form.amount}}),created:function(){this.isAuthenticated&&this.$router.push("/")},mounted:function(){},methods:l(l(l({},Object(a.b)("Purchases",["buyAirtime"])),Object(a.b)("Accounts",["getAccountBalances"])),{},{checkPhone:function(t){console.log(t),t.number&&(t.valid?(this.validation.other_phone="",this.error=null,this.form.other_phone=t.number.replace("+","")):this.validation.other_phone="Number seems to be invalid. Please try again.")},checkAmount:function(t){if(t>=this.minAmount&&t<=this.maxAmount){/^\d+$/.test(t)?(this.validation.amount="",this.form.amount=parseInt(t)):this.validation.amount="Please only put whole numbers"}else"-1"===t?this.otherAmount=!0:this.validation.amount="Amount should be min of ".concat(this.minAmount," and max of ").concat(this.maxAmount)},setOtherNumber:function(t){this.otherNumber=t},setOtherAmount:function(t){this.otherAmount=t},setMethod:function(t){this.form.purchaseMethod=t.toUpperCase(),"VOUCHER"===t&&(this.voucherBalance<parseInt(this.form.amount)&&this.confirmPayment(),console.log(this.voucherBalance,parseInt(this.form.amount)))},confirmPayment:function(){var t=this;i.a.swal({title:"Balance Insufficient",text:"Would you like to top up your voucher?",html:"Current balance: <b>".concat(this.voucherBalance,"</b>, Would you like to top up?"),icon:"info",showCancelButton:!0,confirmButtonText:"Top Up"}).then((function(e){e.isConfirmed?t.$router.push({name:"voucher"}):e.isDenied&&(t.setMethod("MPESA"),t.selectedOption="MPESA")}))},submit:function(){var t,e=this;return(t=n.a.mark((function t(){return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("VOUCHER"!==e.form.purchaseMethod){t.next=3;break}return e.voucherBalance<parseInt(e.form.amount)&&e.confirmPayment(),t.abrupt("return",!1);case 3:return t.prev=3,t.next=6,e.buyAirtime(e.form).then((function(t){console.log("success",t),e.showError=!1,i.a.swal({title:t.status,text:t.message,icon:"success",timer:1500,showConfirmButton:!1,position:"top-end"}),e.$router.push({name:"airtime_status",params:{id:t.data.id}})}),(function(t){console.log("error",t),t.error&&(e.showError=!0),e.loading=!1,e.message=t.response&&t.response.data||t.message||t.error||t.toString()}));case 6:t.next=12;break;case 8:t.prev=8,t.t0=t.catch(3),console.log("purchaseAirtimeVueError",t.t0),e.showError=!0;case 12:case"end":return t.stop()}}),t,null,[[3,8]])})),function(){var e=this,o=arguments;return new Promise((function(r,n){var a=t.apply(e,o);function s(t){u(a,r,n,s,i,"next",t)}function i(t){u(a,r,n,s,i,"throw",t)}s(void 0)}))})()}})},p=o(2),d=Object(p.a)(h,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("CContainer",[o("CRow",{staticClass:"justify-content-center"},[o("CCol",{attrs:{lg:"4",md:"6",sm:"6"}},[o("CCardGroup",[o("CCard",{staticClass:"p-4"},[o("CCardBody",[o("CForm",{on:{submit:function(e){return e.preventDefault(),t.submit(e)}}},[o("h1",[t._v("Buy Airtime")]),t._v(" "),o("p",{staticClass:"text-muted"},[t._v("Kindly fill in the required details")]),t._v(" "),t.showError?o("p",{staticClass:"alert-warning",attrs:{id:"error"}},[t._v("Some details were not filled in\n                                correctly")]):t._e(),t._v(" "),t.error?o("p",{staticClass:"alert-warning"},[t._v("\n                                "+t._s(t.error)+"\n                            ")]):t._e(),t._v(" "),o("div",{staticClass:"mt-3"},[o("CRow",{staticClass:"form-group mb-0",attrs:{form:""}},[o("CCol",{staticClass:"col-form-label",attrs:{md:"6",tag:"label"}},[t._v("\n                                        Other number?\n                                    ")]),t._v(" "),o("CCol",{attrs:{md:"6"}},[o("CSwitch",{staticClass:"mr-1",attrs:{checked:t.otherNumber,color:"info",shape:"pill",slabelOn:"Buy for other",variant:"outline"},on:{"update:checked":t.setOtherNumber}})],1),t._v(" "),t.otherNumber?o("CCol",[o("vue-tel-input",{staticClass:"mt-3",attrs:{invalidMsg:t.error},on:{validate:t.checkPhone}}),t._v(" "),t.errors.phone?o("p",{staticClass:"alert-warning",attrs:{id:"phoneError"}},[t._v("\n                                            "+t._s(t.errors.phone[0])+"\n                                        ")]):t._e(),t._v(" "),t.validation.other_phone?o("p",{staticClass:"alert-warning",attrs:{id:"otherNumberError"}},[t._v("\n                                            "+t._s(t.validation.other_phone)+"\n                                        ")]):t._e()],1):t._e()],1)],1),t._v(" "),o("div",{staticClass:"mt-4"},[o("span",[t._v("Amount")]),t._v(" "),o("CRow",t._l(t.airtimeAmounts,(function(e,r){return o("CCol",{staticClass:"mb-3",attrs:{md:"4",sm:"6",xl:"3"}},[o("CButton",{key:r,attrs:{block:"",color:"primary",shape:"pill"},on:{click:function(e){return t.checkAmount(r)}}},[t._v(t._s(e)+"\n                                        ")])],1)})),1),t._v(" "),o("CInput",{staticClass:"mb-0 mt-3",attrs:{disabled:!t.otherAmount,max:t.maxAmount,min:t.minAmount,placeholder:"amount",type:"number"},on:{"update:value":t.checkAmount},scopedSlots:t._u([{key:"prepend-content",fn:function(){return[o("CIcon",{attrs:{name:"cil-dollar"}})]},proxy:!0}]),model:{value:t.form.amount,callback:function(e){t.$set(t.form,"amount",e)},expression:"form.amount"}}),t._v(" "),t.validation.amount?o("p",{staticClass:"alert-warning",attrs:{id:"amountError"}},[t._v("\n                                    "+t._s(t.validation.amount)+"\n                                ")]):t._e()],1),t._v(" "),o("div",{staticClass:"mt-4"},[o("CRow",{staticClass:"form-group mt-3",attrs:{form:""}},[o("CCol",{attrs:{sm:"6"}},[t._v("\n                                        Payment Method\n                                    ")]),t._v(" "),o("CInputRadioGroup",{staticClass:"col-sm-6",attrs:{checked:t.selectedOption,inline:!0,options:t.options},on:{"update:checked":t.setMethod}}),t._v(" "),t.validation.purchaseMethod?o("p",{staticClass:"alert-warning",attrs:{id:"methodError"}},[t._v("\n                                        "+t._s(t.validation.purchaseMethod)+"\n                                    ")]):t._e()],1)],1),t._v(" "),o("CRow",[o("CCol",{staticClass:"text-left mt-3",attrs:{col:"12"}},[o("CButton",{attrs:{disabled:!t.validForm,color:"primary",sclass:"px-4 mt-3",type:"submit"}},[t._v("Buy\n                                    ")]),t._v(" "),o("CButton",{attrs:{color:"danger",ssize:"sm",type:"reset"}},[t._v("\n                                        Reset\n                                    ")])],1)],1)],1)],1)],1)],1)],1)],1)],1)}),[],!1,null,null,null);e.default=d.exports}}]);